<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Message Format Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .message { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; }
        .error { color: #d32f2f; }
        .success { color: #388e3c; }
        .warning { color: #f57c00; }
    </style>
</head>
<body>
    <h1>MQTT Message Format Test</h1>
    
    <div class="test-section">
        <h2>Substation Topic: scada/grid/substation1/status</h2>
        <p>Expected JSON format:</p>
        <div class="message">
            {
                "voltage": 220.5,
                "current": 15.2,
                "status": "OK",
                "fault_code": 0
            }
        </div>
        <p>Status values: "OK", "WARNING", "FAULT"</p>
    </div>
    
    <div class="test-section">
        <h2>Poles Topic: scada/grid/pole</h2>
        <p>Expected format: $$PoleID,SubstationID,Voltage,Current,ErrorCode##</p>
        
        <h3>Normal Operation (Error Code 0):</h3>
        <div class="message">$$P01,S01,220.0,15.0,0##</div>
        
        <h3>Line Fault (Error Code 27):</h3>
        <div class="message">$$P02,S01,0.0,0.0,27##</div>
        
        <h3>Neutral Break (Error Code 10):</h3>
        <div class="message">$$P03,S01,110.0,7.5,10##</div>
        
        <p><strong>Message Format Breakdown:</strong></p>
        <ul>
            <li><strong>PoleID:</strong> P01, P02, P03, etc. (P prefix removed during parsing)</li>
            <li><strong>SubstationID:</strong> S01, S02, etc. (S prefix removed during parsing)</li>
            <li><strong>Voltage:</strong> Voltage reading in volts</li>
            <li><strong>Current:</strong> Current reading in amperes</li>
            <li><strong>ErrorCode:</strong> 0=Normal, 27=Line Fault, 10=Neutral Break</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>How It Works</h2>
        <ol>
            <li>MQTT Manager subscribes to both topics</li>
            <li>Substation messages (JSON) are parsed and sent to <code>updateSubstationStatus()</code></li>
            <li>Pole messages ($$...##) are parsed and sent to <code>updatePoleStatus()</code></li>
            <li>Fault Manager processes the data and updates the visual display</li>
            <li>Messages are received every 5 seconds as specified</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h2>Error Code Mapping</h2>
        <table border="1" style="border-collapse: collapse; width: 100%;">
            <tr>
                <th>Error Code</th>
                <th>Fault Type</th>
                <th>Status</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>0</td>
                <td>Normal</td>
                <td class="success">OK</td>
                <td>Normal operation, no faults</td>
            </tr>
            <tr>
                <td>27</td>
                <td>Line Fault</td>
                <td class="error">FAULT</td>
                <td>Short circuit or line-to-ground fault</td>
            </tr>
            <tr>
                <td>10</td>
                <td>Neutral Break</td>
                <td class="error">FAULT</td>
                <td>Neutral wire break or fault</td>
            </tr>
        </table>
    </div>
    
    <div class="test-section">
        <h2>Testing</h2>
        <p>To test the system:</p>
        <ol>
            <li>Open the main application (index.html)</li>
            <li>Publish messages to the MQTT topics using an MQTT client</li>
            <li>Watch the visual updates on the map</li>
            <li>Check the event log for status changes</li>
        </ol>
        
        <p><strong>Note:</strong> The system automatically handles both message formats and updates the power grid visualization accordingly.</p>
    </div>
</body>
</html>
